# Review: 17-Layer Documentation Structure

> **Date**: 2026-02-08
> **Scope**: `scc-top/docs/START_HERE.md` + `docs/layers/L1-L17`
> **Reviewer**: Claude Code (automated review)

---

## 一、独立性分析 — 重复内容问题

通读全部17个层文档后，发现存在**大量跨层重复**和**层内自身重复**两类问题。

### 1.1 跨层重复（严重程度：高）

| 重复内容 | 出现位置 | 建议保留位置 |
|----------|----------|-------------|
| **角色定义（9角色表）** | L4 §4.2.1, L6 §6.2.4, L11路由合同引用 | **仅L4**，L6/L11引用链接 |
| **最小技能集（6技能表）** | L4 §4.2.2, L4 §4.2.5尾部, L7 §7.2.2, L13 §13.2.2 | **仅L4**，L7/L13引用链接 |
| **路由契约定义** | L4 §4.2.5, L6 §6.2.4, L11 §11.2.1 | **仅L11**（路由调度层），L4/L6引用 |
| **Capability Catalog（5能力表）** | L4 §4.2.3, L6 §6.2.5 | **仅L4**，L6引用 |
| **执行状态机（SEARCH→...→VERIFY）** | L6 §6.2.1, L9 §9.2.2 | **仅L6**，L9引用 |
| **DLQ/重试规则** | L6 §6.2.1, L11 §11.2.2 | **仅L11**（调度层），L6引用 |
| **工作空间身份（workspace_id）** | L1 §1.2.2, L10 §10.2.1, L10 §10.2.5 | **仅L10**，L1引用 |
| **Executor约束（pins-first等）** | L4角色包, L6 §6.2.4, L7 §7.2.1 | **仅L6**（Agent执行层），L4/L7引用 |
| **裁决规则/fail_class** | L8 §8.2.1-8.2.2, L14 §14.2.2 | **L8完整**, L14引用 |
| **SSOT优先级规则** | L3 §3.2.7, L17 §17.2.5 | **仅L17**（基础层），L3引用 |
| **文档治理规范** | L3 §3.2.1-3.2.2, L17 §17.2.5 | **L3管流程**, L17管元数据，需明确分界 |
| **质量/效率指标** | L12 §12.2.1, L14 §14.2.4, L16 §16.2.4 | **L14定义指标**, L12管成本子集, L16管采集 |
| **Constitution/7原则** | L1 §1.3, L4 §4.2.6(Legal Prefix) | **仅L1**, L4引用 |
| **降级规则（TOP>80行）** | L1 §1.2.3, L15 §15.2.1 | **仅L15**（变更层），L1引用 |

**影响**: 当某条规则需要更新时，必须同时修改3-4个文件，违反了SCC自身的SSOT原则。

### 1.2 层内自身重复（严重程度：中）

多个层文档末尾存在 **"来自SSOT"附录**，与主体内容高度重复：

| 层 | 重复段落 | 说明 |
|----|---------|------|
| **L1** | §1.2.5 重复 §1.2.1 | SCC_TOP宪法内容完全重复 |
| **L2** | §2.2.9 重复 §2.2.1 | 任务模型与Codes完全重复 |
| **L3** | §3.2.8-3.2.9 重复 §3.2.1 | Docflow和Canonical Truth重复 |
| **L4** | §4.2.5尾部技能规范 重复 §4.2.2 | SkillSpec内容重复 |
| **L6** | §6.2.4-6.2.5 重复 §6.2.1和L4 | 角色规范和能力目录 |
| **L9** | 末尾孤立行"4.状态机" | 残留的复制粘贴片段 |
| **L10** | §10.2.5 重复 §10.2.1 | WorkspaceSpec重复 |
| **L11** | §11.2.7 Dispatch Runbook较大段 | 部分与L7工具层重复 |
| **L16** | §16.2.4 重复L12/L14指标 | SCC Observability Spec |

**建议**: 删除所有"来自SSOT"附录段落。这些内容是早期从SSOT合并时的残留，主体部分已包含相同信息。

### 1.3 编号错误

| 位置 | 问题 | 修复 |
|------|------|------|
| L1 §10.2.2 | 编号"10.2.2"出现在L1文档中，应为"1.2.6" | 重新编号 |
| L1 §1.4 出现两次 | "核心功能与脚本"和"脚本使用示例"都用了1.4 | 后者改为1.5 |
| L4 §4.2.4 出现两次 | Pins-first规范和交接模板都用了4.2.4 | 需要重新编号 |
| L9 §9.2.4 位置错乱 | 记忆治理策略放在了"本章小结"之后 | 移到9.2节内 |

---

## 二、真实性分析 — 是否反映SCC系统

### 2.1 准确反映的部分

以下核心机制在文档中有准确描述：

- **闭环7阶段（S1-S7）** — 与SCC_TOP.md一致
- **Pins-First执行模型** — 与AGENTS.md和实际代码一致
- **9角色系统** — 与ROLE_SPEC__v0.1.0.md一致
- **Task Bundle结构** — 与实际契约目录结构一致
- **13道CI门** — 与`tools/scc/gates/`实际脚本一致
- **OID/ULID体系** — 与OID_SPEC__v0.1.0.md一致
- **API端点列表** — 与本地网关(18788端口)实际端点一致
- **SSOT Trunk 7分区** — 与`docs/ssot/`实际目录结构一致

### 2.2 可以增加的内容

| 建议增加 | 所属层 | 理由 |
|----------|--------|------|
| **模型能力矩阵详情**（上下文窗口、多模态支持、cost/token） | L5 | 当前L5是最薄的层，仅有升级策略和推荐表 |
| **Connector（连接器）体系** | L7或新增 | `connectors/registry.json`在L1 CI门中提到，但17层中无专门描述 |
| **ADR流程详情** | L15 | L3提到了ADR格式要求，但L15(变更层)中没有完整的ADR工作流 |
| **Git/分支策略** | L15 | 变更与发布层缺少分支管理规范 |
| **本地部署/开发环境** | L10 | 当前只有workspace_id定义，缺少本地Docker/环境搭建指南 |
| **多Agent并行编排模式** | L11 | Dispatch Runbook放在了L11末尾但不够系统化 |
| **上下文预算分配详情** | L9 | 当前只有概要比例，缺少不同任务类型的具体预算策略 |
| **Hotfix/紧急变更流程** | L15 | 只有标准发布流程，缺少紧急发布路径 |
| **跨层交互协议图** | START_HERE | 每层都有依赖关系，但缺少一张完整的层间交互矩阵 |
| **Skills目录（51个skill）** | L4/L7 | 仓库中有`skills/`目录含51个技能模块，但文档只列了6个最小技能 |

### 2.3 L4与L6的边界模糊

L4（提示词层）和L6（Agent层）之间存在职责重叠：
- L4定义角色（Role）+ 技能（Skill）+ 能力（Capability）
- L6也定义角色路由、角色规范、能力目录

**建议**: L4聚焦"静态定义"（角色是什么、技能是什么、模板是什么），L6聚焦"动态执行"（Agent如何执行、状态机如何流转、DLQ如何处理）。当前两者的边界不够清晰。

### 2.4 L7与L13的边界模糊

L7（工具层）和L13（安全层）在"技能守卫"上重复：
- L7定义技能守卫的执行机制
- L13定义门禁检查

**建议**: L7聚焦"工具注册/发现/执行"，L13聚焦"门禁/权限/审计"。技能守卫在L13中只做引用。

---

## 三、整洁建议

### 3.1 结构性优化

1. **删除所有"来自SSOT"尾部附录** — 与主体重复，估计可减少每个文件15-25%的行数
2. **统一跨层引用方式** — 改为锚点链接引用，而非复制粘贴
3. **修复所有编号错误** — L1的"10.2.2"、L4的重复"4.2.4"等
4. **清理残留片段** — L9末尾的孤立行、L4中YAML代码块中断等

### 3.2 内容优化

1. **L5模型层** — 扩充模型能力矩阵、成本对比、上下文窗口等实用信息
2. **L12成本层** — 增加预算审批流程、成本优化策略
3. **L15变更层** — 增加ADR工作流、Git分支策略、Hotfix流程
4. **START_HERE.md** — 增加一张17层交互关系图（当前只有速查表）

### 3.3 格式统一

- L4文档(735行)过长，可拆分"编译流程"为独立小节
- L8文档中IO Schemas和Evidence Spec用了英文，其他层用中文，建议统一
- 各层的YAML关键文件针脚格式不完全一致（有的有OID，有的没有）

---

## 四、总结

| 维度 | 评分 | 说明 |
|------|------|------|
| **结构完整性** | 8/10 | 17层覆盖全面，缺少Connector和部署层 |
| **独立性** | 5/10 | 大量跨层重复（角色/技能/路由至少出现3-4次） |
| **准确性** | 8/10 | 核心机制反映准确，与SSOT源文件一致 |
| **整洁度** | 5/10 | "来自SSOT"附录残留、编号错误、中英混合 |
| **可维护性** | 4/10 | 同一规则散布在3-4个文件中，更新时容易遗漏 |

**最重要的改进**: 将跨层重复内容改为**引用链接**方式，每条规则只在一个层中完整定义，其他层通过锚点链接引用。这与SCC自身的SSOT原则完全一致。
